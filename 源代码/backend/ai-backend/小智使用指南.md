# 🤖 天大食堂小智 - AI 聊天功能使用指南

## 🎉 功能概述

天大食堂小智是一个智能聊天助手，集成在前端应用的右下角，为用户提供食堂预约和咨询服务。

### ✨ 主要功能
- **智能对话**：基于 DashScope Qwen-Plus 模型的自然语言处理
- **食堂预约**：支持预约查询、预约确认、取消预约等功能
- **流式响应**：实时显示 AI 回复，提供流畅的对话体验
- **连接状态**：实时显示连接状态和重试机制
- **快捷问题**：预设常见问题，一键提问

## 🚀 启动步骤

### 1. 启动后端服务
```bash
# 在项目根目录
mvn spring-boot:run
```
确保后端运行在 http://localhost:8080

### 2. 启动前端服务
```bash
# 在 front/qiantai 目录
npm install
npm run serve
```
确保前端运行在 http://localhost:8081

### 3. 运行完整测试
```bash
# 运行集成测试脚本
test_full_integration.bat
```

## 💬 使用方法

### 基本操作
1. **打开聊天窗口**：点击右下角的"小智助手"悬浮按钮
2. **发送消息**：在输入框中输入问题，按回车或点击发送按钮
3. **使用快捷问题**：点击预设的快捷问题标签
4. **关闭窗口**：点击聊天窗口右上角的关闭按钮

### 连接状态指示
- 🟢 **在线**：成功连接到后端服务
- 🟡 **连接中...**：正在尝试连接后端
- 🔴 **离线**：连接失败或断开

### 重试机制
- 自动重试最多 3 次
- 递增延迟（2秒、4秒、6秒）
- 超过重试次数后显示详细错误信息

## 🎯 测试建议

### 基础对话测试
```
用户: 你好
预期: AI 自我介绍和服务说明

用户: 你是谁？
预期: 介绍自己是天大食堂小智

用户: 你能帮我做什么？
预期: 列出可提供的服务
```

### 预约功能测试
```
用户: 我想预约明天的午餐
预期: 询问具体食堂、时间等信息

用户: 帮我预约北洋园食堂明天中午12点的位置
预期: 调用预约工具，查询餐位并确认预约

用户: 我想预约学一食堂后天的晚餐
预期: 处理预约请求并提供反馈
```

### 查询功能测试
```
用户: 查询北洋园食堂明天午餐时间是否有位置
预期: 调用查询工具，返回餐位情况

用户: 学二食堂今天晚上还有位置吗？
预期: 查询指定食堂的餐位状态

用户: 帮我查一下卫津路食堂的餐位情况
预期: 提供餐位查询结果
```

### 取消预约测试
```
用户: 我想取消预约
预期: 询问具体要取消的预约信息

用户: 帮我取消明天的午餐预约
预期: 调用取消预约工具并确认
```

## 🔧 技术特性

### 前端特性
- **Vue.js 2.6** 组件化开发
- **Element UI** 现代化界面
- **流式响应处理** 实时显示内容
- **自动重试机制** 提高连接稳定性
- **响应式设计** 适配不同屏幕

### 后端特性
- **Spring Boot 3.2** 微服务架构
- **LangChain4j** AI 集成框架
- **DashScope Qwen-Plus** 大语言模型
- **MyBatis Plus** 数据库操作
- **流式响应** 支持实时数据传输

### 安全特性
- **环境变量配置** 保护敏感信息
- **CORS 配置** 跨域请求支持
- **错误处理** 完善的异常处理机制

## 🛠️ 故障排除

### 常见问题

#### 1. 聊天按钮不显示
**可能原因**：
- 前端服务未启动
- 组件导入错误
- 浏览器缓存问题

**解决方案**：
```bash
# 重新启动前端服务
cd front/qiantai
npm run serve

# 清除浏览器缓存
Ctrl + F5 (强制刷新)
```

#### 2. 发送消息失败
**可能原因**：
- 后端服务未启动
- 网络连接问题
- API 密钥配置错误

**解决方案**：
```bash
# 检查后端状态
curl http://localhost:8080/doc.html

# 检查后端日志
# 查看控制台输出是否有错误信息

# 验证 API 密钥
# 检查 application.properties 中的配置
```

#### 3. 流式响应不工作
**可能原因**：
- 代理配置问题
- 浏览器不支持流式响应
- 网络防火墙阻止

**解决方案**：
```bash
# 检查代理配置
# 查看 vue.config.js 中的 proxy 设置

# 测试直接连接
curl -X POST http://localhost:8080/xiaozhi/chat \
  -H "Content-Type: application/json" \
  -d '{"memoryId":1,"message":"测试"}'
```

#### 4. 连接状态显示离线
**可能原因**：
- 后端服务未启动
- 端口被占用
- 防火墙阻止连接

**解决方案**：
```bash
# 检查端口占用
netstat -ano | findstr :8080

# 重启后端服务
mvn spring-boot:run

# 检查防火墙设置
```

### 调试方法

#### 前端调试
1. **打开浏览器开发者工具** (F12)
2. **查看 Console 面板** 检查 JavaScript 错误
3. **查看 Network 面板** 检查 API 请求状态
4. **查看 Application 面板** 检查本地存储

#### 后端调试
1. **查看控制台日志** 检查启动和运行日志
2. **访问 Swagger UI** http://localhost:8080/doc.html
3. **测试 API 接口** 使用 Postman 或 curl
4. **检查数据库连接** 确认 MySQL 服务状态

## 📈 性能优化

### 前端优化
- **组件懒加载** 减少初始加载时间
- **消息虚拟滚动** 处理大量历史消息
- **防抖处理** 避免频繁发送请求
- **缓存机制** 缓存常用响应

### 后端优化
- **连接池配置** 优化数据库连接
- **缓存策略** 缓存频繁查询结果
- **异步处理** 提高并发处理能力
- **监控告警** 实时监控系统状态

## 🔮 未来规划

### 功能增强
- [ ] 语音输入支持
- [ ] 图片上传功能
- [ ] 多语言支持
- [ ] 主题切换
- [ ] 消息搜索

### 技术升级
- [ ] Vue 3 升级
- [ ] TypeScript 支持
- [ ] PWA 支持
- [ ] 移动端优化
- [ ] 离线模式

### 业务扩展
- [ ] 多食堂支持
- [ ] 个性化推荐
- [ ] 营养分析
- [ ] 社交功能
- [ ] 积分系统

---

## 📞 技术支持

如果您在使用过程中遇到问题，请：

1. **查看本文档** 的故障排除部分
2. **运行测试脚本** `test_full_integration.bat`
3. **检查日志输出** 前端控制台和后端日志
4. **联系开发团队** 提供详细的错误信息

祝您使用愉快！🎉
